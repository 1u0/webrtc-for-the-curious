<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="What is WebRTC. #  WebRTC is both an API and Protocol. The WebRTC protocol is a set of rules for two agents to negotiate bi-directional secure communication. The WebRTC API was designed just for Javascript. This Javascript API then allows web developers to use the WebRTC protocol in the browser.
A similar relationship would be HTTP and the fetch API. WebRTC the protocol would be HTTP, and WebRTC the API would be the fetch API."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="What, Why and How"><meta property="og:description" content="What is WebRTC. #  WebRTC is both an API and Protocol. The WebRTC protocol is a set of rules for two agents to negotiate bi-directional secure communication. The WebRTC API was designed just for Javascript. This Javascript API then allows web developers to use the WebRTC protocol in the browser.
A similar relationship would be HTTP and the fetch API. WebRTC the protocol would be HTTP, and WebRTC the API would be the fetch API."><meta property="og:type" content="article"><meta property="og:url" content="https://webrtcforthecurious.com/docs/01-what-why-and-how/"><meta property="article:modified_time" content="2020-08-05T14:03:16-07:00"><title>What, Why and How | WebRTC for the Curious</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY="><script defer src=/en.search.min.9cbed1ef81d6f384e1edc6f966f83146ed53584ced8dc2d3e0258be5eba4508e.js integrity="sha256-nL7R74HW84Th7cb5ZvgxRu1TWEztjcLT4CWL5eukUI4="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>WebRTC for the Curious</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/introduction/>Introduction</a></li><li><a href=/docs/01-what-why-and-how/ class=active>What, Why and How</a></li><li><a href=/docs/02-signaling/>Signaling</a></li><li><a href=/docs/03-connecting/>Connecting</a></li><li><a href=/docs/04-securing/>Securing</a></li><li><a href=/docs/05-media-communication/>Media Communication</a></li><li><a href=/docs/06-data-communication/>Data Communication</a></li><li><a href=/docs/08-debugging/>Debugging</a></li><li><a href=/docs/09-history-of-webrtc/>History</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>What, Why and How</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#what-is-webrtc>What is WebRTC.</a></li><li><a href=#why-should-i-learn-webrtc>Why should I learn WebRTC?</a></li><li><a href=#how-does-webrtc-the-protocol-work>How does WebRTC (the protocol) Work</a><ul><li><a href=#signaling>Signaling</a></li><li><a href=#connecting>Connecting</a></li><li><a href=#securing>Securing</a></li><li><a href=#communicating>Communicating</a></li></ul></li><li><a href=#webrtc-a-collection-of-protocols>WebRTC, a collection of protocols</a></li><li><a href=#how-does-webrtc-the-api-work>How does WebRTC (the API) work</a><ul><li><a href=#new-peerconnection>new PeerConnection</a></li><li><a href=#addtrack>addTrack</a></li><li><a href=#createdatachannel>createDataChannel</a></li><li><a href=#createoffer>createOffer</a></li><li><a href=#setlocaldescription>setLocalDescription</a></li><li><a href=#setremotedescription>setRemoteDescription</a></li><li><a href=#addicecandidate>addicecandidate</a></li><li><a href=#ontrack>ontrack</a></li><li><a href=#oniceconnectionstatechange>oniceconnectionstatechange</a></li><li><a href=#onstatechange>onstatechange</a></li></ul></li></ul></nav></aside></header><article class=markdown><h2 id=what-is-webrtc>What is WebRTC.
<a class=anchor href=#what-is-webrtc>#</a></h2><p>WebRTC is both an API and Protocol. The WebRTC protocol is a set of rules for two agents to negotiate bi-directional secure communication. The WebRTC API was designed just for Javascript. This Javascript API then allows web developers to use the WebRTC protocol in the browser.</p><p>A similar relationship would be HTTP and the fetch API. WebRTC the protocol would be HTTP, and WebRTC the API would be the fetch API.</p><p>Many other APIs besides Javascript, servers and tools exist for WebRTC. All of these implementations can interact with each others.</p><h2 id=why-should-i-learn-webrtc>Why should I learn WebRTC?
<a class=anchor href=#why-should-i-learn-webrtc>#</a></h2><p>These are the things that WebRTC will give you. This list is not exhaustive but is some of the things you may appreciate during your journey. Don&rsquo;t worry if you don&rsquo;t know some of these terms yet, this book will teach you them along tne way.</p><ul><li>Open Standard</li><li>Multiple Implementations</li><li>Available in Browsers</li><li>Mandatory Encryption</li><li>NAT Traversal</li><li>Repurposed existing technology</li><li>Congestion Control</li><li>Sub-Second Latency</li></ul><h2 id=how-does-webrtc-the-protocol-work>How does WebRTC (the protocol) Work
<a class=anchor href=#how-does-webrtc-the-protocol-work>#</a></h2><p>This is a question that takes an entire book to explain. However, to start off we break it into four steps.</p><ul><li>Signaling</li><li>Connecting</li><li>Securing</li><li>Communicating</li></ul><p>These four steps happen sequentially. The prior step must be 100% successful for the subsequent one to even begin. At a high level this is what each one of these steps is accomplishing.</p><p>One pecuilar fact about WebRTC is that it actually made up of many other protocols! To make WebRTC we stitch together many existing technologies. In that sense WebRTC is more a combination and configuration of well understood tech that has been around since the early 2000s.</p><p>Each of these steps have dedicated chapters, but it is helpful to understand them at a high level first. Since they are dependant on each other it will help explain each steps purpose more.</p><h3 id=signaling>Signaling
<a class=anchor href=#signaling>#</a></h3><p>When a WebRTC Agent starts it has no idea who it is going to communicate with and what they are going to communicate about. Signaling solves this issue! Signaling is used to bootstrap the call so that the two WebRTC agents can start communicating directly.</p><p>Signaling uses an existing protocol SDP. SDP is a plain text buffer made up off key/value pairs and contains a list of &lsquo;media sections&rsquo;. The SDP that the two WebRTC Agents exchange contains details like.</p><ul><li>IPs and Ports that the agent is reachable on (candidates)</li><li>How many audio and video tracks the agent wishes to send</li><li>What audio and video codecs the agent supports</li><li>Values used while connecting (uFrag/uPwd)</li><li>Values used while securing (certificate fingerprint)</li></ul><h3 id=connecting>Connecting
<a class=anchor href=#connecting>#</a></h3><p>The two WebRTC Agents now know enough details to attempt to connect to each other. WebRTC again uses an existing technology called ICE.</p><p>ICE (Interactive Connectivity Establishment) is a protocol that pre-dates WebRTC. ICE allows the establishment of a connection between two Agents. These Agents could be in the same network, or on the other side of the world. ICE is the solution to establishing a direct connection without a central server.</p><p>The real magic here is &lsquo;NAT Traversal&rsquo; and TURN Servers. These two concepts are all you need to communicate with an IP/Port in another subnet. This is where STUN and TURN come into play. We will explore these topics in depth later.</p><p>Once ICE successfully connects, WebRTC then moves on to establishing an encrypted transport. This transport is used for the audio, video and data.</p><h3 id=securing>Securing
<a class=anchor href=#securing>#</a></h3><p>Now that we have bi-directional communication (via ICE) we need to establish secure communication. This is done through two protocols that pre-date WebRTC. The first protocol is DTLS (Datagram Transport Layer Security) which is just TLS over UDP. TLS is the technology that powers HTTPS. The second protocol is SRTP (Secure Real-time Transport Protocol).</p><p>First WebRTC connects by doing a DTLS handshake over the connection established by ICE. Unlike HTTPS WebRTC doesnt use a central authority for certificates. Instead WebRTC just asserts that the certificate exchanged via DTLS matches the the fingerprint shared via signaling. This DTLS connection is then used for DataChannel messages.</p><p>WebRTC then uses a different protocol for audio/video transmission called RTP. We secure our RTP packets using SRTP. We initialize our SRTP session by extracting the keys from the negotiated DTLS session. In a later chapter we discuss why media transmission has its own protocol.</p><p>We are done! You now have bi-directional and secure communication. If you have a stable connection between your WebRTC Agents this is all the complexity you may need. Unfortunately the real world has packet loss and bandwidth limits, and the next section is about how we deal with them.</p><h3 id=communicating>Communicating
<a class=anchor href=#communicating>#</a></h3><p>We now have two WebRTC Agents with secure bi-directional communication. Lets start communicating! Again we use two pre-existing protocol RTP (Real-time Transport Protocol) and SCTP (Stream Control Transmission Protocol).</p><p>RTP is used to carry media, and is encrypted using SRTP. The RTP protocol is quite minimal, but gives us what we need to implement real-time streaming. The important thing is that RTP gives flexibility to the developer so they can handle latency, loss and congestion as they please. We will discuss this further in the media chapter!</p><p>The final protocol in the stack is SCTP. SCTP is used to send DataChannel messages and those messages are encrypted with DTLS. SCTP allows many different delivery options for messages. You can optionally choose to have unreliable, out of order delivery so you can get the latency needed for real-time systems.</p><h2 id=webrtc-a-collection-of-protocols>WebRTC, a collection of protocols
<a class=anchor href=#webrtc-a-collection-of-protocols>#</a></h2><p><strong>TODO a diagram of protocols working together</strong></p><p>WebRTC solves a lot of problems. At first this may even seem over-engineered. The genius of WebRTC is really the humility. It didn&rsquo;t assume it could solve everything better. Instead it embraced many existing single purpose technologies and bundled them together.</p><p>This allows us to examine and learn each part individually without being overwhelmed.</p><h2 id=how-does-webrtc-the-api-work>How does WebRTC (the API) work
<a class=anchor href=#how-does-webrtc-the-api-work>#</a></h2><p>This section shows how the Javascript API maps to the protcol. If you aren&rsquo;t familiar with either that is ok. This is a fun section to return to as you learn more!</p><h3 id=new-peerconnection>new PeerConnection
<a class=anchor href=#new-peerconnection>#</a></h3><p>The PeerConnection is the top level &lsquo;WebRTC Session&rsquo;. It contains all the protocols mentioned above. The subsystems are all allocated but nothing happens yet.</p><h3 id=addtrack>addTrack
<a class=anchor href=#addtrack>#</a></h3><p>addTrack creates a new RTP stream. A random SSRC will be generated for this stream. This stream will then be inside the Session Description generated by createOffer inside a media section. Each call to addTrack will create a new SSRC and media section.</p><p>Immediately after a SRTP Session is established these media packets will start being sent via ICE and encrypted with SRTP.</p><h3 id=createdatachannel>createDataChannel
<a class=anchor href=#createdatachannel>#</a></h3><p>createDataChannel creates a new SCTP
stream. If this is the first Data Channel being created a SCTP association is started. The SCTP subsystem is not actually started until the first DataChannel is requested.</p><p>Immediately after a DTLS Session is established these media packets will start being sent via ICE after encrypted using DTLS.</p><h3 id=createoffer>createOffer
<a class=anchor href=#createoffer>#</a></h3><p>createOffer generates a Session Description of the local state to be shared with the remote peer.</p><p>The act of calling createOffer doesn&rsquo;t change anything for the local peer.</p><h3 id=setlocaldescription>setLocalDescription
<a class=anchor href=#setlocaldescription>#</a></h3><p>setLocalDescription commits any requsted changes. addTrack, createDataChannel and similar calls are all temporary until this call. setLocalDescription is called with the value generated by createOffer.</p><p>Usually after this call you will send the offer to the remote peer, and they will call setRemoteDescription with it.</p><h3 id=setremotedescription>setRemoteDescription
<a class=anchor href=#setremotedescription>#</a></h3><p>setRemoteDescription is how we inform the local agent about the remote candidates state. This is where &lsquo;Signaling&rsquo; is done.</p><p>When setRemoteDesc</p><h3 id=addicecandidate>addicecandidate
<a class=anchor href=#addicecandidate>#</a></h3><h3 id=ontrack>ontrack
<a class=anchor href=#ontrack>#</a></h3><h3 id=oniceconnectionstatechange>oniceconnectionstatechange
<a class=anchor href=#oniceconnectionstatechange>#</a></h3><h3 id=onstatechange>onstatechange
<a class=anchor href=#onstatechange>#</a></h3></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/webrtc-for-the-curious/webrtc-for-the-curious/commit/ef84531b02c67146ae098cba6f0bdfe0d5edd967 title="Last modified by Sean DuBois | August 5, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>August 5, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/webrtc-for-the-curious/webrtc-for-the-curious/edit/master/content//docs/01-what-why-and-how.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#what-is-webrtc>What is WebRTC.</a></li><li><a href=#why-should-i-learn-webrtc>Why should I learn WebRTC?</a></li><li><a href=#how-does-webrtc-the-protocol-work>How does WebRTC (the protocol) Work</a><ul><li><a href=#signaling>Signaling</a></li><li><a href=#connecting>Connecting</a></li><li><a href=#securing>Securing</a></li><li><a href=#communicating>Communicating</a></li></ul></li><li><a href=#webrtc-a-collection-of-protocols>WebRTC, a collection of protocols</a></li><li><a href=#how-does-webrtc-the-api-work>How does WebRTC (the API) work</a><ul><li><a href=#new-peerconnection>new PeerConnection</a></li><li><a href=#addtrack>addTrack</a></li><li><a href=#createdatachannel>createDataChannel</a></li><li><a href=#createoffer>createOffer</a></li><li><a href=#setlocaldescription>setLocalDescription</a></li><li><a href=#setremotedescription>setRemoteDescription</a></li><li><a href=#addicecandidate>addicecandidate</a></li><li><a href=#ontrack>ontrack</a></li><li><a href=#oniceconnectionstatechange>oniceconnectionstatechange</a></li><li><a href=#onstatechange>onstatechange</a></li></ul></li></ul></nav></aside></main></body></html>