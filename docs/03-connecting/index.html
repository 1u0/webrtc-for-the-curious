<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Why do I need a dedicated subsystem for connecting? #  WwbRTC will go to great lengths to acheive bi-directional communication between two agents. These agents can be in different networks with no direct communication. But by using NAT traversal WebRTC makes it happen. The packets aren&rsquo;t even routed through a relay, it is a direct connection.
In situations where direct connectivity isn&rsquo;t possible WebRTC has other techniques all well. You can use a TURN server to communicate across protocols (UDP <-> TCP) and versions (IPv4 <-> IPv6) and in places where NAT Traversal can&rsquo;t do the job."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Connecting"><meta property="og:description" content="Why do I need a dedicated subsystem for connecting? #  WwbRTC will go to great lengths to acheive bi-directional communication between two agents. These agents can be in different networks with no direct communication. But by using NAT traversal WebRTC makes it happen. The packets aren&rsquo;t even routed through a relay, it is a direct connection.
In situations where direct connectivity isn&rsquo;t possible WebRTC has other techniques all well. You can use a TURN server to communicate across protocols (UDP <-> TCP) and versions (IPv4 <-> IPv6) and in places where NAT Traversal can&rsquo;t do the job."><meta property="og:type" content="article"><meta property="og:url" content="https://webrtcforthecurious.com/docs/03-connecting/"><meta property="article:modified_time" content="2020-08-10T23:39:38-07:00"><title>Connecting | WebRTC for the Curious</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY="><script defer src=/en.search.min.dce1aab5733c1a97708de70c95aa134057845b1003014667013a4dc25853c4a6.js integrity="sha256-3OGqtXM8GpdwjecMlaoTQFeEWxADAUZnATpNwlhTxKY="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>WebRTC for the Curious</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/01-what-why-and-how/>What, Why and How</a></li><li><a href=/docs/02-signaling/>Signaling</a></li><li><a href=/docs/03-connecting/ class=active>Connecting</a></li><li><a href=/docs/04-securing/>Securing</a></li><li><a href=/docs/05-media-communication/>Media Communication</a></li><li><a href=/docs/06-data-communication/>Data Communication</a></li><li><a href=/docs/08-debugging/>Debugging</a></li><li><a href=/docs/09-history-of-webrtc/>History</a></li><li><a href=/docs/10-faq/>FAQ</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Connecting</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#why-do-i-need-a-dedicated-subsystem-for-connecting>Why do I need a dedicated subsystem for connecting?</a></li><li><a href=#how-does-it-work>How does it work?</a></li><li><a href=#networking-real-world-constraints>Networking real world constraints</a><ul><li><a href=#not-in-the-same-network>Not in the same network</a></li><li><a href=#protocol-restrictions>Protocol Restrictions</a></li><li><a href=#firewallids-rules>Firewall/IDS Rules</a></li></ul></li><li><a href=#network-address-translation-address-and-port-mapping>Network Address Translation Address and Port Mapping</a><ul><li><a href=#creating-a-mapping>Creating a Mapping</a></li><li><a href=#mapping-creation-behaviors>Mapping Creation Behaviors</a></li><li><a href=#mapping-filtering-behaviors>Mapping Filtering Behaviors</a></li><li><a href=#mapping-lifetimes>Mapping Lifetimes</a></li></ul></li><li><a href=#stun->STUN ()</a></li><li><a href=#turn->TURN ()</a></li><li><a href=#ice->ICE ()</a><ul><li><a href=#candidate-gathering>Candidate Gathering</a></li><li><a href=#connectivity-checks>Connectivity Checks</a></li><li><a href=#candidate-selection>Candidate Selection</a></li></ul></li></ul></nav></aside></header><article class=markdown><h2 id=why-do-i-need-a-dedicated-subsystem-for-connecting>Why do I need a dedicated subsystem for connecting?
<a class=anchor href=#why-do-i-need-a-dedicated-subsystem-for-connecting>#</a></h2><p>WwbRTC will go to great lengths to acheive bi-directional communication between two agents. These agents can be in different networks with no direct communication. But by using NAT traversal WebRTC makes it happen. The packets aren&rsquo;t even routed through a relay, it is a direct connection.</p><p>In situations where direct connectivity isn&rsquo;t possible WebRTC has other techniques all well. You can use a TURN server to communicate across protocols (UDP &lt;-> TCP) and versions (IPv4 &lt;-> IPv6) and in places where NAT Traversal can&rsquo;t do the job.</p><p>Because WebRTC does this you get</p><ul><li>No Bandwidth Costs from running servers</li></ul><p>Since all the communication happens directly during peers you don&rsquo;t have to pay for transporting that data!</p><ul><li>Lower Latency</li></ul><p>Communication is much faster when it is direct! If a user has to run everything through you server it makes things a lot slower.</p><ul><li>Secure E2E Communication</li></ul><p>Direct Communication is also more secure. Since users aren&rsquo;t routing your data through your server they don&rsquo;t even need to trust you won&rsquo;t decrypt it.</p><h2 id=how-does-it-work>How does it work?
<a class=anchor href=#how-does-it-work>#</a></h2><p>The process described above is <a href=https://tools.ietf.org/html/rfc8445>ICE</a>. Another protocol that pre-dates WebRTC.</p><p>ICE is a protocol that tries to find the best way to communicate between two ICE Agents. Each ICE Agenta publishes the ways it is reachable, these are known as candidatea. ICE then determines the best candidate pair.</p><p>The actual ICE Process is described in greater detail later in this chapter. To understand why ICE exists it is useful to understand what network behaviors it is taking advantage of.</p><h2 id=networking-real-world-constraints>Networking real world constraints
<a class=anchor href=#networking-real-world-constraints>#</a></h2><p>ICE is all about overcoming the constraints of real world networks. Before we even explore the solution lets talk about the actual problems.</p><h3 id=not-in-the-same-network>Not in the same network
<a class=anchor href=#not-in-the-same-network>#</a></h3><p>Most of the time the other WebRTC Agent will not even be in the same network! A typical call will usually have two WebRTC Agents in different networks with no direct connectivity.</p><p>Visually it looks something like.</p><p><em>TODO Two peers inside different NATs</em></p><h3 id=protocol-restrictions>Protocol Restrictions
<a class=anchor href=#protocol-restrictions>#</a></h3><h3 id=firewallids-rules>Firewall/IDS Rules
<a class=anchor href=#firewallids-rules>#</a></h3><h2 id=network-address-translation-address-and-port-mapping>Network Address Translation Address and Port Mapping
<a class=anchor href=#network-address-translation-address-and-port-mapping>#</a></h2><p>NAT Mapping is the magic that makes the direct connectivity of WebRTC possible. With this you can have two peers in completely different networks communicating directly. This behavior allows traffic to an external address be forwarded to an internal host.</p><p><em>TODO port forwarding diagram</em></p><p>NAR mapping essentially is a automated/config-less version of doing port forwarding in your router.</p><p>The downside to NAT Mapping is that it has been implemented in many different ways. In some cases network administrators may even disable it entirely.</p><h3 id=creating-a-mapping>Creating a Mapping
<a class=anchor href=#creating-a-mapping>#</a></h3><h3 id=mapping-creation-behaviors>Mapping Creation Behaviors
<a class=anchor href=#mapping-creation-behaviors>#</a></h3><h3 id=mapping-filtering-behaviors>Mapping Filtering Behaviors
<a class=anchor href=#mapping-filtering-behaviors>#</a></h3><h3 id=mapping-lifetimes>Mapping Lifetimes
<a class=anchor href=#mapping-lifetimes>#</a></h3><h2 id=stun->STUN ()
<a class=anchor href=#stun->#</a></h2><h2 id=turn->TURN ()
<a class=anchor href=#turn->#</a></h2><h2 id=ice->ICE ()
<a class=anchor href=#ice->#</a></h2><h3 id=candidate-gathering>Candidate Gathering
<a class=anchor href=#candidate-gathering>#</a></h3><h4 id=host>Host
<a class=anchor href=#host>#</a></h4><h4 id=host-mdns>Host (mDNS)
<a class=anchor href=#host-mdns>#</a></h4><h4 id=server-reflexive>Server Reflexive
<a class=anchor href=#server-reflexive>#</a></h4><h4 id=relay>Relay
<a class=anchor href=#relay>#</a></h4><h3 id=connectivity-checks>Connectivity Checks
<a class=anchor href=#connectivity-checks>#</a></h3><h4 id=peer-reflexive-candidates>Peer Reflexive Candidates
<a class=anchor href=#peer-reflexive-candidates>#</a></h4><h3 id=candidate-selection>Candidate Selection
<a class=anchor href=#candidate-selection>#</a></h3></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/webrtc-for-the-curious/webrtc-for-the-curious/commit/c67ab7b47e493b616a4aa47e5b691fb7611d18a8 title="Last modified by Sean DuBois | August 11, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>August 11, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/webrtc-for-the-curious/webrtc-for-the-curious/edit/master/content//docs/03-connecting.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#why-do-i-need-a-dedicated-subsystem-for-connecting>Why do I need a dedicated subsystem for connecting?</a></li><li><a href=#how-does-it-work>How does it work?</a></li><li><a href=#networking-real-world-constraints>Networking real world constraints</a><ul><li><a href=#not-in-the-same-network>Not in the same network</a></li><li><a href=#protocol-restrictions>Protocol Restrictions</a></li><li><a href=#firewallids-rules>Firewall/IDS Rules</a></li></ul></li><li><a href=#network-address-translation-address-and-port-mapping>Network Address Translation Address and Port Mapping</a><ul><li><a href=#creating-a-mapping>Creating a Mapping</a></li><li><a href=#mapping-creation-behaviors>Mapping Creation Behaviors</a></li><li><a href=#mapping-filtering-behaviors>Mapping Filtering Behaviors</a></li><li><a href=#mapping-lifetimes>Mapping Lifetimes</a></li></ul></li><li><a href=#stun->STUN ()</a></li><li><a href=#turn->TURN ()</a></li><li><a href=#ice->ICE ()</a><ul><li><a href=#candidate-gathering>Candidate Gathering</a></li><li><a href=#connectivity-checks>Connectivity Checks</a></li><li><a href=#candidate-selection>Candidate Selection</a></li></ul></li></ul></nav></aside></main></body></html>